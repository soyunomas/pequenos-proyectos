# --- CONFIGURACIÃ“N DEL PROYECTO ---
BINARY_NAME=inputflow
CMD_PATH=cmd/inputflow/main.go
INSTALL_PATH=/usr/local/bin/$(BINARY_NAME)
CONFIG_PATH=config.toml

# --- FLAGS DE COMPILACIÃ“N (OPTIMIZACIÃ“N) ---
# -s: Elimina la tabla de sÃ­mbolos (reduce tamaÃ±o).
# -w: Elimina informaciÃ³n de depuraciÃ³n DWARF (reduce tamaÃ±o).
# -trimpath: Elimina rutas absolutas del sistema de archivos (build reproducible y mÃ¡s seguro).
LDFLAGS=-ldflags "-s -w"

.PHONY: all build run scan clean install uninstall help

# Por defecto, compila
all: build

# ğŸ”¨ CompilaciÃ³n optimizada
build:
	@echo "âš™ï¸  Compilando binario optimizado (Release Mode)..."
	go mod tidy
	go build $(LDFLAGS) -trimpath -o $(BINARY_NAME) $(CMD_PATH)
	@echo "âœ… Binario generado: ./$(BINARY_NAME)"

# ğŸš€ Ejecutar (Requiere sudo para /dev/input/)
run: build
	@echo "ğŸ”¥ Ejecutando InputFlow (Root requerido para leer Hardware)..."
	sudo ./$(BINARY_NAME)

# ğŸ” Modo EscÃ¡ner RÃ¡pido
scan: build
	@echo "ğŸ•µï¸  Iniciando EscÃ¡ner de Hardware..."
	sudo ./$(BINARY_NAME) -scan

# ğŸ“¦ InstalaciÃ³n al sistema (System-wide)
install: build
	@echo "ğŸ“¦ Instalando en $(INSTALL_PATH)..."
	sudo cp $(BINARY_NAME) $(INSTALL_PATH)
	sudo chmod +x $(INSTALL_PATH)
	@echo "âœ¨ InstalaciÃ³n completada. Ejecuta 'sudo inputflow' desde cualquier lugar."

# ğŸ—‘ï¸ DesinstalaciÃ³n
uninstall:
	@echo "ğŸ—‘ï¸  Eliminando $(INSTALL_PATH)..."
	sudo rm -f $(INSTALL_PATH)

# ğŸ§¹ Limpieza
clean:
	@echo "ğŸ§¹ Limpiando artefactos..."
	rm -f $(BINARY_NAME)
	go clean

help:
	@echo "ğŸ“– Comandos disponibles:"
	@echo "  make build    - Compila el binario localmente."
	@echo "  make run      - Compila y ejecuta el demonio."
	@echo "  make scan     - Compila y ejecuta el escÃ¡ner de dispositivos."
	@echo "  make install  - Instala el binario en /usr/local/bin."
	@echo "  make clean    - Borra el binario."
