<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador Markdown a HTML (Personalizable)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap Icons CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* === Definición de Variables CSS por Defecto === */
        :root {
            --color-h1: #0d6efd;
            --color-h2: #0dcaf0;
            --color-h3: #6c757d;
            --color-h4: #198754;
            --color-h5: #fd7e14; /* Añadido H5 para consistencia */
            --color-h6: #6f42c1; /* Añadido H6 para consistencia */
            --color-code: #d63384;
            --bg-pre: #f8f9fa;
            --bg-code-inline: #f8f9fa; /* Fondo para código inline */
            --color-indice-link: #0d6efd;
            --color-indice-link-hover: #0a58ca;
            --bg-indice-link-hover: #ffffff;
            --color-indice-link-active: #212529;
            --bg-indice-link-active: #e9ecef;
            --border-ejercicios: #0dcaf0;
            --bg-ejercicios: #f8f9fa;
        }

        /* === ESTILOS GENERALES USANDO VARIABLES === */
        body { position: relative; }
        #seccionEntrada { padding-bottom: 1.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid #dee2e6; }
        #markdownInput { min-height: 150px; font-family: monospace; font-size: 0.9rem; }
        #seccionSalida { /* Contenedor del row */ }
        #indiceContenido {
            position: sticky; top: 1rem;
            height: calc(100vh - 2rem);
            overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem;
            padding: 1rem; background-color: #f8f9fa; /* Fondo base del índice */
        }
        #indiceContenido .nav-link.active, #indiceContenido .nav-link:focus {
            color: var(--color-indice-link-active); background-color: var(--bg-indice-link-active); font-weight: 500;
        }
        #indiceContenido .nav-link {
            color: var(--color-indice-link); padding-top: 0.3rem; padding-bottom: 0.3rem; border-radius: 0.25rem; font-size: 0.9rem;
        }
        #indiceContenido .nav-link:hover {
            color: var(--color-indice-link-hover); background-color: var(--bg-indice-link-hover);
        }
        #indiceContenido #indiceNav .nav-link { padding-left: 0.5rem; }
        #indiceContenido #indiceNav .ps-3 { padding-left: 1.5rem !important; }
        #indiceContenido #indiceNav .ps-4 { padding-left: 2.5rem !important; }
        #indiceContenido #indiceNav .ps-5 { padding-left: 3.5rem !important; }
        #mainContent { min-height: calc(100vh - 300px); }
        #mainContent h1[id], #mainContent h2[id], #mainContent h3[id],
        #mainContent h4[id], #mainContent h5[id], #mainContent h6[id] {
             padding-top: 120px; /* AJUSTAR */
             margin-top: -110px; /* AJUSTAR */
         }
        #mainContent h1, #mainContent h2, #mainContent h3, #mainContent h4, #mainContent h5, #mainContent h6 { margin-top: 1.5rem; margin-bottom: 1rem; }
        #mainContent h1 { color: var(--color-h1); }
        #mainContent h2 { color: var(--color-h2); }
        #mainContent h3 { color: var(--color-h3); }
        #mainContent h4 { color: var(--color-h4); }
        #mainContent h5 { color: var(--color-h5); }
        #mainContent h6 { color: var(--color-h6); }
        #mainContent pre { background-color: var(--bg-pre); border: 1px solid #dee2e6; border-radius: 0.25rem; padding: 1rem; overflow-x: auto; white-space: pre-wrap; word-break: break-word; margin-top: 1rem; margin-bottom: 1rem; }
        #mainContent code { /* Código inline y dentro de pre */
             color: var(--color-code); word-wrap: break-word;
        }
        #mainContent pre code { /* Estilos específicos si es necesario para code dentro de pre */
             background-color: transparent; border: none; padding: 0; font-size: 0.9em;
        }
        #mainContent :not(pre) > code { /* Estilos específicos para code inline */
            background-color: var(--bg-code-inline);
            padding: 0.1em 0.3em; border-radius: 0.2rem; font-size: 0.9em;
        }
        #mainContent h5 + ol, #mainContent h5 + ul {
            border-left: 4px solid var(--border-ejercicios);
            padding: 1rem 1rem 1rem 1.5rem; margin-top: 1.5rem; margin-bottom: 1.5rem;
            background-color: var(--bg-ejercicios); border-radius: 0.25rem;
        }
        #mainContent h5 + ol > li, #mainContent h5 + ul > li { margin-bottom: 0.5rem; }
        #mainContent h5 + ol > li strong, #mainContent h5 + ul > li strong { color: var(--border-ejercicios); } /* Usar el mismo color que el borde? o definir otra variable? */
        #mainContent h4 + p + pre, #mainContent h4 + p + ol + pre, #mainContent h4 + pre { margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px dashed #dee2e6; }
        #mainContent > *:last-child pre, #mainContent > *:last-child > pre { border-bottom: none; }
        #mainContent .table { margin-top: 1rem; margin-bottom: 1rem; }

        /* Estilos para el Offcanvas y controles */
        .offcanvas-body label { display: block; margin-bottom: 0.25rem; font-weight: 500; }
        .offcanvas-body input[type="color"] { width: 100%; height: 40px; border: 1px solid #ccc; padding: 0.25rem; cursor: pointer; margin-bottom: 1rem; }
        .offcanvas-body .form-group { margin-bottom: 1rem; } /* Grupo para label+input */

        /* === FIN ESTILOS === */
    </style>
</head>
<!-- Offset de Scrollspy para la APP -->
<body data-bs-spy="scroll" data-bs-target="#indiceContenido" data-bs-offset="120" tabindex="0">

<div class="container-fluid mt-3">
    <!-- Sección Superior: Entrada y Controles -->
    <div id="seccionEntrada">
        <h1>Generador Markdown a HTML</h1>
        <div class="mb-3">
            <label for="markdownInput" class="form-label">Introduce tu Markdown aquí:</label>
            <textarea id="markdownInput" class="form-control" rows="8"></textarea>
        </div>
        <button id="convertButton" class="btn btn-primary me-2">Generar HTML y Índice</button>
        <button id="downloadButton" class="btn btn-success me-2" disabled>Descargar HTML</button>
        <!-- Botón para abrir configurador -->
        <button class="btn btn-outline-secondary" type="button" data-bs-toggle="offcanvas" data-bs-target="#styleConfigOffcanvas" aria-controls="styleConfigOffcanvas">
            <i class="bi bi-gear"></i> Configurar Estilos
        </button>
    </div>

    <!-- Sección Inferior: Salida (Estructura de 2 columnas) -->
    <div id="seccionSalida" class="row">
        <!-- Columna Izquierda: Índice -->
        <div class="col-md-4 col-lg-3 d-none d-md-block">
            <nav id="indiceContenido">
                <h5 class="mb-3">Índice</h5>
                <nav class="nav nav-pills flex-column" id="indiceNav">
                    <span class="text-muted small">El índice aparecerá aquí.</span>
                </nav>
            </nav>
        </div>
        <!-- Columna Derecha: Contenido Principal -->
        <div class="col-md-8 col-lg-9">
            <main id="mainContent">
                <p class="text-muted pt-5">El contenido HTML generado aparecerá aquí.</p>
            </main>
        </div>
    </div>
</div>

<!-- Offcanvas para Configuración de Estilos -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="styleConfigOffcanvas" aria-labelledby="styleConfigOffcanvasLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="styleConfigOffcanvasLabel">Configuración de Estilos</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <p>Ajusta los colores. Los cambios se aplicarán en vivo.</p>
    <hr>
    <div class="form-group">
        <label for="colorH1Input">Color H1:</label>
        <input type="color" id="colorH1Input" data-css-var="--color-h1">
    </div>
    <div class="form-group">
        <label for="colorH2Input">Color H2:</label>
        <input type="color" id="colorH2Input" data-css-var="--color-h2">
    </div>
    <div class="form-group">
        <label for="colorH3Input">Color H3:</label>
        <input type="color" id="colorH3Input" data-css-var="--color-h3">
    </div>
     <div class="form-group">
        <label for="colorH4Input">Color H4:</label>
        <input type="color" id="colorH4Input" data-css-var="--color-h4">
    </div>
    <hr>
    <div class="form-group">
        <label for="colorCodeInput">Color Código:</label>
        <input type="color" id="colorCodeInput" data-css-var="--color-code">
    </div>
     <div class="form-group">
        <label for="bgPreInput">Fondo Bloque Código (pre):</label>
        <input type="color" id="bgPreInput" data-css-var="--bg-pre">
    </div>
    <div class="form-group">
        <label for="bgCodeInlineInput">Fondo Código Inline (code):</label>
        <input type="color" id="bgCodeInlineInput" data-css-var="--bg-code-inline">
    </div>
    <hr>
     <div class="form-group">
        <label for="colorIndiceLinkInput">Color Enlace Índice:</label>
        <input type="color" id="colorIndiceLinkInput" data-css-var="--color-indice-link">
    </div>
     <div class="form-group">
        <label for="colorIndiceLinkHoverInput">Color Enlace Índice (Hover):</label>
        <input type="color" id="colorIndiceLinkHoverInput" data-css-var="--color-indice-link-hover">
    </div>
     <div class="form-group">
        <label for="bgIndiceLinkHoverInput">Fondo Enlace Índice (Hover):</label>
        <input type="color" id="bgIndiceLinkHoverInput" data-css-var="--bg-indice-link-hover">
    </div>
     <div class="form-group">
        <label for="colorIndiceLinkActiveInput">Color Enlace Índice (Activo):</label>
        <input type="color" id="colorIndiceLinkActiveInput" data-css-var="--color-indice-link-active">
    </div>
     <div class="form-group">
        <label for="bgIndiceLinkActiveInput">Fondo Enlace Índice (Activo):</label>
        <input type="color" id="bgIndiceLinkActiveInput" data-css-var="--bg-indice-link-active">
    </div>
     <hr>
      <div class="form-group">
        <label for="borderEjerciciosInput">Color Borde/Título Ejercicios:</label>
        <input type="color" id="borderEjerciciosInput" data-css-var="--border-ejercicios">
    </div>
     <div class="form-group">
        <label for="bgEjerciciosInput">Fondo Bloque Ejercicios:</label>
        <input type="color" id="bgEjerciciosInput" data-css-var="--bg-ejercicios">
    </div>
    <hr>
    <button id="resetStylesButton" class="btn btn-outline-danger w-100">Restablecer Colores Predeterminados</button>

  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
    // --- ELEMENTOS DEL DOM --- (Sin cambios)
    const markdownInput = document.getElementById('markdownInput');
    const convertButton = document.getElementById('convertButton');
    const downloadButton = document.getElementById('downloadButton');
    const mainContent = document.getElementById('mainContent');
    const indiceNav = document.getElementById('indiceNav');
    const indiceContenidoElement = document.getElementById('indiceContenido');
    const scrollSpyOffsetApp = 120; // Offset para la APLICACIÓN

    // --- ELEMENTOS DEL CONFIGURADOR ---
    const styleConfigOffcanvasEl = document.getElementById('styleConfigOffcanvas');
    const configInputs = styleConfigOffcanvasEl.querySelectorAll('input[data-css-var]');
    const resetStylesButton = document.getElementById('resetStylesButton');


    // --- FUNCIONES AUXILIARES --- (Sin cambios, excepto por la variable de offset)
    function generarSlug(texto) { if (!texto) return 'seccion-vacia'; return 'seccion-' + texto.toString().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/\s+/g, '-').replace(/[^\w-]+/g, '').replace(/--+/g, '-').replace(/^-+/, '').replace(/-+$/, ''); }
    function setupSmoothScroll() { document.querySelectorAll('#indiceNav a[href^="#"]').forEach(anchor => { anchor.removeEventListener('click', handleSmoothScroll); anchor.addEventListener('click', handleSmoothScroll); }); }
    function handleSmoothScroll(e) { e.preventDefault(); const targetId = this.getAttribute('href'); try { const targetElement = document.querySelector(targetId); if(targetElement) { const offsetPosition = targetElement.offsetTop - scrollSpyOffsetApp + 5; window.scrollTo({ top: offsetPosition, behavior: 'smooth' }); } else { console.warn(`Elemento no encontrado (smooth scroll): ${targetId}`); } } catch (error) { console.error(`Error smooth scroll: ${error}`); } }
    function refreshScrollSpy() { setTimeout(() => { try { let scrollSpyInstance = bootstrap.ScrollSpy.getInstance(document.body); if (scrollSpyInstance) { scrollSpyInstance.refresh(); } else { scrollSpyInstance = new bootstrap.ScrollSpy(document.body, { target: '#indiceContenido', offset: scrollSpyOffsetApp }); } window.scrollBy(0, 1); window.scrollBy(0, -1); } catch (e) { console.error("Error ScrollSpy refresh/init:", e); } }, 150); }


    // --- LÓGICA DE CONFIGURACIÓN DE ESTILOS ---

    // Objeto para almacenar los valores por defecto (leídos del CSS inicial)
    const defaultStyleValues = {};

    // Función para aplicar un estilo (actualiza variable CSS)
    function applyStyle(cssVar, value) {
         document.documentElement.style.setProperty(cssVar, value);
    }

     // Función para leer los valores por defecto de las variables CSS
    function loadDefaultStyles() {
        const computedStyles = getComputedStyle(document.documentElement);
        configInputs.forEach(input => {
            const cssVar = input.dataset.cssVar;
            if (cssVar) {
                // Obtener el valor por defecto computado y limpiarlo
                const defaultValue = computedStyles.getPropertyValue(cssVar).trim();
                defaultStyleValues[cssVar] = defaultValue; // Guardar para el reset
                input.value = defaultValue; // Establecer valor inicial del input
            }
        });
        console.log("Default styles loaded:", defaultStyleValues);
    }

    // Función para restablecer a los valores por defecto
    function resetToDefaultStyles() {
        console.log("Resetting styles to default");
        configInputs.forEach(input => {
            const cssVar = input.dataset.cssVar;
            if (cssVar && defaultStyleValues[cssVar]) {
                const defaultValue = defaultStyleValues[cssVar];
                input.value = defaultValue; // Resetear input
                applyStyle(cssVar, defaultValue); // Resetear variable CSS
            }
        });
    }

    // Inicializar configuración de estilos al cargar
    document.addEventListener('DOMContentLoaded', () => {
        loadDefaultStyles();

        // Añadir listeners a los inputs del configurador
        configInputs.forEach(input => {
            const cssVar = input.dataset.cssVar;
            if (cssVar) {
                input.addEventListener('input', (event) => {
                    applyStyle(cssVar, event.target.value);
                });
            }
        });

         // Listener para el botón de reset
        resetStylesButton.addEventListener('click', resetToDefaultStyles);
    });


    // --- LÓGICA PRINCIPAL (renderizarContenido - Sin cambios) ---
    function renderizarContenido() { const markdownTexto = markdownInput.value; downloadButton.disabled = true; mainContent.innerHTML = '<p class="text-muted pt-5">Generando...</p>'; indiceNav.innerHTML = '<span class="text-muted small">Generando índice...</span>'; setTimeout(() => { if (!markdownTexto.trim()) { mainContent.innerHTML = '<p class="text-muted pt-5">Introduce Markdown arriba para generar contenido.</p>'; indiceNav.innerHTML = '<span class="text-muted small">El índice aparecerá aquí.</span>'; refreshScrollSpy(); return; } try { const rawHtml = marked.parse(markdownTexto); const tempDiv = document.createElement('div'); tempDiv.innerHTML = rawHtml; const headingsData = []; const headings = tempDiv.querySelectorAll('h1, h2, h3, h4'); headings.forEach((heading, index) => { const level = parseInt(heading.tagName.substring(1), 10); const text = heading.textContent || `encabezado-${index}`; const slug = generarSlug(`${level}-${text}`); heading.id = slug; if (level <= 4) { headingsData.push({ level, text, slug }); } }); let indiceHtmlInterno = ''; headingsData.forEach(item => { let paddingClass = ''; if (item.level === 2) paddingClass = 'ps-3'; if (item.level === 3) paddingClass = 'ps-4'; if (item.level === 4) paddingClass = 'ps-5'; indiceHtmlInterno += `<a class="nav-link ${paddingClass}" href="#${item.slug}">${item.text}</a>`; }); mainContent.innerHTML = tempDiv.innerHTML; if (indiceHtmlInterno) { indiceNav.innerHTML = indiceHtmlInterno; } else { indiceNav.innerHTML = '<span class="text-muted small">No se encontraron H1-H4.</span>'; } setupSmoothScroll(); refreshScrollSpy(); downloadButton.disabled = false; } catch (error) { console.error("Error conversión Markdown:", error); mainContent.innerHTML = `<div class="alert alert-danger" role="alert"><strong>Error:</strong> ${error.message}</div>`; indiceNav.innerHTML = '<span class="text-danger small">Error.</span>'; downloadButton.disabled = true; refreshScrollSpy(); } }, 50); }

    // --- FUNCIÓN DE DESCARGA (Modificada para incluir estilos personalizados) ---
    function descargarHtml() {
        if (downloadButton.disabled) return;

        const indiceHtmlCompleto = indiceContenidoElement.innerHTML;
        const contenidoHtml = mainContent.innerHTML;
        const estilosCssBase = document.querySelector('style').textContent; // Obtiene TODO el CSS base
        const tituloPagina = "Contenido Generado (Personalizado)";
        const scrollSpyOffsetStatic = 100; // Offset para ESTÁTICO

        // *** Generar bloque de variables CSS personalizadas ***
        let customVariablesCss = ':root {\n';
        configInputs.forEach(input => {
            const cssVar = input.dataset.cssVar;
            if (cssVar) {
                customVariablesCss += `  ${cssVar}: ${input.value};\n`; // Usar valor actual del input
            }
        });
        customVariablesCss += '}';
        // *** Fin generación bloque variables ***

        const htmlCompleto = `<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${tituloPagina}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* 1. Incluir los estilos base de la aplicación */
        ${estilosCssBase}

        /* 2. Sobrescribir/Añadir las variables CSS con los valores personalizados */
        ${customVariablesCss}

        /* 3. Ajustes específicos para la versión estática */
        body { padding-top: 1rem; }
        #indiceContenido { position: sticky; top: 1rem; height: calc(100vh - 2rem); overflow-y: auto; }
        #mainContent { min-height: auto; }
        #seccionEntrada { display: none !important; }
         #mainContent h1[id], #mainContent h2[id], #mainContent h3[id],
         #mainContent h4[id], #mainContent h5[id], #mainContent h6[id] {
             padding-top: ${scrollSpyOffsetStatic + 10}px; margin-top: -${scrollSpyOffsetStatic}px;
         }
    </style>
</head>
<body data-bs-spy="scroll" data-bs-target="#indiceContenido" data-bs-offset="${scrollSpyOffsetStatic}">
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-md-4 col-lg-3 d-none d-md-block">
             <nav id="indiceContenido">
                 ${indiceHtmlCompleto}
             </nav>
        </div>
        <div class="col-md-8 col-lg-9">
            <main id="mainContent">
                ${contenidoHtml}
            </main>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"><\/script>
<script>
    // Script inyectado para Scrollspy/SmoothScroll (sin cambios)
    document.addEventListener('DOMContentLoaded', () => {
        const staticOffset = ${scrollSpyOffsetStatic};
        try { new bootstrap.ScrollSpy(document.body, { target: '#indiceContenido', offset: staticOffset }); window.dispatchEvent(new Event('scroll')); } catch (e) { console.error('Failed static ScrollSpy:', e); }
        document.querySelectorAll('#indiceNav a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault(); const targetId = this.getAttribute('href'); const targetElement = document.querySelector(targetId);
                if (targetElement) { const offsetPosition = targetElement.offsetTop - staticOffset + 5; window.scrollTo({ top: offsetPosition, behavior: 'smooth' }); }
                else { console.warn('Target not found:', targetId); }
            });
        });
    });
<\/script>
</body>
</html>`;

        // Crear Blob y descargar
        const blob = new Blob([htmlCompleto], { type: 'text/html;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'generado_personalizado.html';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }


    // --- EVENT LISTENERS E INICIALIZACIÓN ---
    convertButton.addEventListener('click', renderizarContenido);
    downloadButton.addEventListener('click', descargarHtml);
    // Scrollspy para la APP se inicializa en el listener DOMContentLoaded ahora

    // --- EJEMPLO MARKDOWN INICIAL --- (El mismo)
    markdownInput.value = `# Título Principal (H1)

Esto es un párrafo introductorio con **negrita** y *cursiva*.

## Subtítulo Nivel 2 (H2) - Características

Explicación de las características principales. Añadiendo más texto para asegurar que hay suficiente contenido como para hacer scroll cómodamente y probar el funcionamiento del índice y el resaltado. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.

### Sub-subtítulo Nivel 3 (H3) - Detalle A

Más detalles sobre la característica A. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.

#### Detalle A.1 (H4)
Este es un detalle de nivel 4 bajo Detalle A. Debería aparecer en el índice con mayor sangría.

\`\`\`sql
-- Ejemplo de código SQL en bloque
SELECT ID_Cliente, Nombre, FechaRegistro
FROM Clientes
WHERE Activo = 1
ORDER BY FechaRegistro DESC;
\`\`\`

Aquí hay código inline: \`const x = 10;\`.

### Sub-subtítulo Nivel 3 (H3) - Detalle B

Detalles sobre la característica B. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Necesitamos bastante contenido vertical para que el scroll sea significativo.

#### Detalle B.1 (H4)
Otro detalle de nivel 4, esta vez bajo Detalle B.

\`\`\`javascript
// Ejemplo de código JavaScript
function calcularTotal(precio, cantidad) {
  if (cantidad < 0) {
    throw new Error("La cantidad no puede ser negativa.");
  }
  return precio * cantidad;
}
\`\`\`

## Otra Sección H2 - Ejemplos Prácticos

Lista de ejemplos:
*   Ejemplo 1: Creación de vista simple.
*   Ejemplo 2: Consulta con JOIN a través de una vista.
    *   Sub-ejemplo 2.1: Filtrando resultados.
*   Ejemplo 3: Vista con agregación.

Más texto de relleno. Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt.

#### Título H4 Independiente
Este es un H4 directamente bajo el H2. También debería aparecer en el índice. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.

##### ✨ Bloque Simulado de Ejercicios ✨ (H5 - No aparece en índice)
1.  **Ejercicio SQL:** Crea una vista que muestre solo los clientes de 'Madrid'.
    \`\`\`sql
    -- Tu código aquí
    \`\`\`
2.  **Ejercicio JS:** Llama a la función \`calcularTotal\` con valores válidos.

#### ANEXO - Ejercicio Resuelto (H4)
Este es el H4 del anexo. Debería estar en el índice.
**1. Solución Ejercicio SQL:**
\`\`\`sql
CREATE VIEW ClientesMadrid AS
SELECT *
FROM Clientes
WHERE Ciudad = 'Madrid';
\`\`\`

---
Fin del contenido de ejemplo. Se añade espacio vertical extra para forzar el scroll.












Más y más espacio...












Para probar bien el Scrollspy.












Última línea de prueba aquí abajo.
`;

</script>

</body>
</html>